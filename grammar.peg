// AUWGENT YAML-Lite v1 — PEG Grammar Specification
// This is DOCUMENTATION ONLY. Not executed. Hand-implemented in TypeScript.
//
// Design Principles:
//   - Streaming-safe (token-by-token)
//   - Partial document support
//   - Deterministic (no ambiguity)
//   - Zero external dependencies
//
// ═══════════════════════════════════════════════════════════════════════════

// ─────────────────────────────────────────────────────────────────────────────
// DOCUMENT
// ─────────────────────────────────────────────────────────────────────────────

Document
  = lines:Line* EOF
  { return buildDocument(lines); }

Line
  = BlankLine
  / CommentLine
  / ContentLine

BlankLine
  = INDENT* NEWLINE
  { return null; }

CommentLine
  = INDENT* "#" (!NEWLINE .)* NEWLINE
  { return null; }

ContentLine
  = indent:INDENT* content:(Mapping / SequenceItem) NEWLINE
  { return { indent: indent.length, ...content }; }


// ─────────────────────────────────────────────────────────────────────────────
// MAPPINGS (Objects)
// ─────────────────────────────────────────────────────────────────────────────

Mapping
  = key:Key COLON value:InlineValue?
  { return { type: 'mapping', key, value }; }

Key
  = chars:$[a-zA-Z_][a-zA-Z0-9_]*
  { return chars; }

COLON
  = ":" SPACE*


// ─────────────────────────────────────────────────────────────────────────────
// SEQUENCES (Arrays)
// ─────────────────────────────────────────────────────────────────────────────

SequenceItem
  = DASH SPACE+ value:(Mapping / Scalar)
  { return { type: 'sequence_item', value }; }

DASH
  = "-"


// ─────────────────────────────────────────────────────────────────────────────
// SCALARS
// ─────────────────────────────────────────────────────────────────────────────

InlineValue
  = SPACE* value:(QuotedString / UnquotedScalar) InlineComment?
  { return value; }

QuotedString
  = DoubleQuotedString
  / SingleQuotedString

DoubleQuotedString
  = '"' chars:$[^"\n]* '"'
  { return { type: 'scalar', value: chars, quoted: true }; }

SingleQuotedString
  = "'" chars:$[^'\n]* "'"
  { return { type: 'scalar', value: chars, quoted: true }; }

UnquotedScalar
  = chars:$[^\n#]+
  { return { type: 'scalar', value: chars.trim(), quoted: false }; }


// ─────────────────────────────────────────────────────────────────────────────
// COMMENTS
// ─────────────────────────────────────────────────────────────────────────────

InlineComment
  = SPACE* "#" (!NEWLINE .)*


// ─────────────────────────────────────────────────────────────────────────────
// PRIMITIVES
// ─────────────────────────────────────────────────────────────────────────────

INDENT
  = "  "  // Exactly 2 spaces per indent level

SPACE
  = " "

NEWLINE
  = "\n"
  / "\r\n"

EOF
  = !.


// ─────────────────────────────────────────────────────────────────────────────
// RESERVED KEYS (Semantic, not syntactic)
// ─────────────────────────────────────────────────────────────────────────────
//
// The following keys have special meaning in the IR layer:
//
//   id       → Node identity for references
//   ref      → Reference to another node by id
//   extends  → Structural inheritance (merge)
//   intent   → Agent execution trigger
//
// These are NOT enforced at parse time. Handled during IR building.
//
// ─────────────────────────────────────────────────────────────────────────────


// ─────────────────────────────────────────────────────────────────────────────
// STREAMING BEHAVIOR
// ─────────────────────────────────────────────────────────────────────────────
//
// The parser MUST support:
//
//   1. Partial input — EOF at any point is valid
//   2. Incremental parsing — can add more input after parse
//   3. Auto-close blocks — open blocks are closed on dedent or EOF
//   4. Event emission — middleware can hook into parse events
//
// Token stream example:
//
//   Input: "intent:\n  type: tool_call\n"
//
//   Tokens:
//     INDENT(0) KEY("intent") COLON NEWLINE
//     INDENT(2) KEY("type") COLON SCALAR("tool_call") NEWLINE
//     DEDENT(0) EOF
//
// ─────────────────────────────────────────────────────────────────────────────
